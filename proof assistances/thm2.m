[q1,~] = qr(randn(3,3))
c1 = [q1 randn(3,1)]
[q2,~] = qr(randn(3,3))
c2 = [q2 randn(3,1)]
[q3,~] = qr(randn(3,3))
c3 = [q3 randn(3,1)]
[q4,~] = qr(randn(3,3))
c4 = [q4 randn(3,1)]
[q5,~] = qr(randn(3,3))




%STEP 1 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%THE FOLLOWING CALCULATION SHOWS lambda1ii = lambdaii1 WHENEVER 1,i ARE
%DISTINCT
%col labels: (21,[11]), (21,[21]), (21,[31]), (21,[12]), (12,[11])
%row labels: (1,[1]), (1,[2]), (1,[3]), (2,[1]), (2,[2]) 

t211 = trifocal(c2,c1,c1);
t221 = trifocal(c2,c2,c1);
t112 = trifocal(c1,c1,c2);
t122 = trifocal(c1,c2,c2);

m = [t211(1,1,1) t211(2,1,1) t211(3,1,1) t211(1,1,2) t112(1,1,1)
    t211(1,2,1) t211(2,2,1) t211(3,2,1) t211(1,2,2) t112(1,2,1)
    t211(1,3,1) t211(2,3,1) t211(3,3,1) t211(1,3,2) t112(1,3,1)
    t221(1,1,1) t221(2,1,1) t221(3,1,1) t221(1,1,2) t122(1,1,1) 
    t221(1,2,1) t221(2,2,1) t221(3,2,1) t221(1,2,2) t122(1,2,1)] 

a = randn
b = randn

n = [t211(1,1,1) t211(2,1,1) t211(3,1,1) t211(1,1,2) t112(1,1,1)
    t211(1,2,1) t211(2,2,1) t211(3,2,1) t211(1,2,2) t112(1,2,1)
    t211(1,3,1) t211(2,3,1) t211(3,3,1) t211(1,3,2) t112(1,3,1)
    a*t221(1,1,1) a*t221(2,1,1) a*t221(3,1,1) a*t221(1,1,2) b*t122(1,1,1) 
    a*t221(1,2,1) a*t221(2,2,1) a*t221(3,2,1) a*t221(1,2,2) b*t122(1,2,1)] 

svd(m) 
%A sanity check: rank deficient as expected

svd(n) 
%Full rank as wanted.  Follows det of m with lambda is a nonzero scalar 
%multiple of lambdaii1*(lambda1ii-lambdaii1). So assumptions imply 
%lambda1ii=lambdaii1

%By symmetry of the 2nd and 3rd modes, we also have lambda1ii = lambdai1i.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%STEP 2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%THE FOLLOWING CALCULATION SHOWS lambda1ij = lambdaji1 WHENEVER 1,i,j ARE
%ALL DISTINCT
%col labels: (31,[11]), (31,[21]), (31,[31]), (31,[12]), (13,[11])
%row labels: (1,[1]), (1,[2]), (1,[3]), (2,[1]), (2,[2]) 

t311 = trifocal(c3,c1,c1);
t321 = trifocal(c3,c2,c1);
t113 = trifocal(c1,c1,c3);
t123 = trifocal(c1,c2,c3);

m = [t311(1,1,1) t311(2,1,1) t311(3,1,1) t311(1,1,2) t113(1,1,1)
    t311(1,2,1) t311(2,2,1) t311(3,2,1) t311(1,2,2) t113(1,2,1)
    t311(1,3,1) t311(2,3,1) t311(3,3,1) t311(1,3,2) t113(1,3,1)
    t321(1,1,1) t321(2,1,1) t321(3,1,1) t321(1,1,2) t123(1,1,1) 
    t321(1,2,1) t321(2,2,1) t321(3,2,1) t321(1,2,2) t123(1,2,1)] 

a = randn
b = randn

n = [t311(1,1,1) t311(2,1,1) t311(3,1,1) t311(1,1,2) t113(1,1,1)
    t311(1,2,1) t311(2,2,1) t311(3,2,1) t311(1,2,2) t113(1,2,1)
    t311(1,3,1) t311(2,3,1) t311(3,3,1) t311(1,3,2) t113(1,3,1)
    a*t321(1,1,1) a*t321(2,1,1) a*t321(3,1,1) a*t321(1,1,2) b*t123(1,1,1) 
    a*t321(1,2,1) a*t321(2,2,1) a*t321(3,2,1) a*t321(1,2,2) b*t123(1,2,1)] 

svd(m) 
%A sanity check: rank deficient as expected

svd(n) 
%Full rank as wanted.  Follows det of m with lambda is a nonzero scalar 
%multiple of lambdaji1*(lambda1ij-lambdaji1). So assumptions imply 
%lambda1ij=lambdaji1

%By symmetry of the 2nd and 3rd modes, we also have lambda1ij = lambdai1j.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%






%STEP 3
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%THE FOLLOWING CALCULATION SHOWS lambdaji1 = lambda1ik WHENEVER 1,i,j,k ARE
%DISTINCT
%col labels: (31,[11]), (31,[21]), (31,[31]), (31,[12]), (14,[11])
%row labels: (1,[1]), (1,[2]), (1,[3]), (2,[1]), (2,[2]) 

t311 = trifocal(c3,c1,c1);
t321 = trifocal(c3,c2,c1);
t114 = trifocal(c1,c1,c4);
t124 = trifocal(c1,c2,c4);


m = [t311(1,1,1) t311(2,1,1) t311(3,1,1) t311(1,1,2) t114(1,1,1)
    t311(1,2,1) t311(2,2,1) t311(3,2,1) t311(1,2,2) t114(1,2,1)
    t311(1,3,1) t311(2,3,1) t311(3,3,1) t311(1,3,2) t114(1,3,1)
    t321(1,1,1) t321(2,1,1) t321(3,1,1) t321(1,1,2) t124(1,1,1) 
    t321(1,2,1) t321(2,2,1) t321(3,2,1) t321(1,2,2) t124(1,2,1)]

a = randn
b = randn

n = [t311(1,1,1) t311(2,1,1) t311(3,1,1) t311(1,1,2) t114(1,1,1)
    t311(1,2,1) t311(2,2,1) t311(3,2,1) t311(1,2,2) t114(1,2,1)
    t311(1,3,1) t311(2,3,1) t311(3,3,1) t311(1,3,2) t114(1,3,1)
    a*t321(1,1,1) a*t321(2,1,1) a*t321(3,1,1) a*t321(1,1,2) b*t124(1,1,1) 
    a*t321(1,2,1) a*t321(2,2,1) a*t321(3,2,1) a*t321(1,2,2) b*t124(1,2,1)]

svd(m)
%A sanity check: rank deficient as expected

svd(n)
%Full rank as wanted.  Follows det of m with lambda is a nonzero scalar 
%multiple of lambdaji1*(lambdaji1-lambda1ik). So assumptions imply 
%lambdaji1=lambda1ik

%By symmetry of the 2nd and 3rd modes, we also have lambdai1j = lambda1kj.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%STEP 4
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%THE FOLLOWING CALCULATION SHOWS lambdaji1 = lambda1ii WHENEVER 1,i,j ARE
%DISTINCT
%col labels: (31,[11]), (31,[21]), (31,[31]), (31,[12]), (12,[11])
%row labels: (1,[1]), (1,[2]), (1,[3]), (2,[1]), (2,[2]) 

t311 = trifocal(c3,c1,c1);
t321 = trifocal(c3,c2,c1);
t112 = trifocal(c1,c1,c2);
t122 = trifocal(c1,c2,c2);


m = [t311(1,1,1) t311(2,1,1) t311(3,1,1) t311(1,1,2) t112(1,1,1)
    t311(1,2,1) t311(2,2,1) t311(3,2,1) t311(1,2,2) t112(1,2,1)
    t311(1,3,1) t311(2,3,1) t311(3,3,1) t311(1,3,2) t112(1,3,1)
    t321(1,1,1) t321(2,1,1) t321(3,1,1) t321(1,1,2) t122(1,1,1) 
    t321(1,2,1) t321(2,2,1) t321(3,2,1) t321(1,2,2) t122(1,2,1)]

a = randn
b = randn

n = [t311(1,1,1) t311(2,1,1) t311(3,1,1) t311(1,1,2) t112(1,1,1)
    t311(1,2,1) t311(2,2,1) t311(3,2,1) t311(1,2,2) t112(1,2,1)
    t311(1,3,1) t311(2,3,1) t311(3,3,1) t311(1,3,2) t112(1,3,1)
    a*t321(1,1,1) a*t321(2,1,1) a*t321(3,1,1) a*t321(1,1,2) b*t122(1,1,1) 
    a*t321(1,2,1) a*t321(2,2,1) a*t321(3,2,1) a*t321(1,2,2) b*t122(1,2,1)]

svd(m)
%A sanity check: rank deficient as expected

svd(n)
%Full rank as wanted.  Follows det of m with lambda is a nonzero scalar 
%multiple of lambdaji1*(lambdaji1-lambda1ii). So assumptions imply 
%lambdaji1=lambda1ii
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%At this point we know lambdasigma(1ij) and lambdasigma(1ii) all take the
%same value, call it c


%STEP 5 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%THE FOLLOWING CALCULATION SHOWS lambdaiij = c^2 WHENEVER 1,i,j ARE
%DISTINCT
%col labels: (12,[11]), (12,[21]), (12,[31]), (12,[12]), (23,[11])
%row labels: (1,[1]), (1,[2]), (1,[3]), (2,[1]), (2,[2])
t112 = trifocal(c1,c1,c2)
t122 = trifocal(c1,c2,c2)
t213 = trifocal(c2,c1,c3)
t223 = trifocal(c2,c2,c3)

m = [t112(1,1,1) t112(2,1,1) t112(3,1,1) t112(1,1,2) t213(1,1,1)
    t112(1,2,1) t112(2,2,1) t112(3,2,1) t112(1,2,2) t213(1,2,1)
    t112(1,3,1) t112(2,3,1) t112(3,3,1) t112(1,3,2) t213(1,3,1)
    t122(1,1,1) t122(2,1,1) t122(3,1,1) t122(1,1,2) t223(1,1,1)
    t122(1,2,1) t122(2,2,1) t122(3,2,1) t122(1,2,2) t223(1,2,1)]
    
a = randn
b = randn

n = [t112(1,1,1) t112(2,1,1) t112(3,1,1) t112(1,1,2) a*t213(1,1,1)
    t112(1,2,1) t112(2,2,1) t112(3,2,1) t112(1,2,2) a*t213(1,2,1)
    t112(1,3,1) t112(2,3,1) t112(3,3,1) t112(1,3,2) a*t213(1,3,1)
    a*t122(1,1,1) a*t122(2,1,1) a*t122(3,1,1) a*t122(1,1,2) b*t223(1,1,1)
    a*t122(1,2,1) a*t122(2,2,1) a*t122(3,2,1) a*t122(1,2,2) b*t223(1,2,1)]

svd(m)
%A sanity check: rank deficient as expected

svd(n)
%Full rank as wanted.  Follows det of m with lambda is a nonzero scalar 
%multiple of c*(lambda223-c^2). So assumptions imply 
%lambdaiij=c^2 

%By symmetry between second and third modes, also have lambdaiji=c^2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





%STEP 6
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%THE FOLLOWING CALCULATION SHOWS lambdajii = c^2 WHENEVER 1,i,j ARE
%DISTINCT
%col labels: (12,[11]), (12,[21]), (12,[31]), (12,[12]), (32,[11])
%row labels: (1,[1]), (1,[2]), (1,[3]), (2,[1]), (2,[2])
t112 = trifocal(c1,c1,c2)
t122 = trifocal(c1,c2,c2)
t312 = trifocal(c3,c1,c2)
t322 = trifocal(c3,c2,c2)

m = [t112(1,1,1) t112(2,1,1) t112(3,1,1) t112(1,1,2) t312(1,1,1)
    t112(1,2,1) t112(2,2,1) t112(3,2,1) t112(1,2,2) t312(1,2,1)
    t112(1,3,1) t112(2,3,1) t112(3,3,1) t112(1,3,2) t312(1,3,1)
    t122(1,1,1) t122(2,1,1) t122(3,1,1) t122(1,1,2) t322(1,1,1)
    t122(1,2,1) t122(2,2,1) t122(3,2,1) t122(1,2,2) t322(1,2,1)]
    
a = randn
b = randn

n = [t112(1,1,1) t112(2,1,1) t112(3,1,1) t112(1,1,2) a*t312(1,1,1)
    t112(1,2,1) t112(2,2,1) t112(3,2,1) t112(1,2,2) a*t312(1,2,1)
    t112(1,3,1) t112(2,3,1) t112(3,3,1) t112(1,3,2) a*t312(1,3,1)
    a*t122(1,1,1) a*t122(2,1,1) a*t122(3,1,1) a*t122(1,1,2) b*t322(1,1,1)
    a*t122(1,2,1) a*t122(2,2,1) a*t122(3,2,1) a*t122(1,2,2) b*t322(1,2,1)]

svd(m)
%A sanity check: rank deficient as expected

svd(n)
%Full rank as wanted.  Follows det of m with lambda is a nonzero scalar 
%multiple of c*(lambda223-c^2). So assumptions imply 
%lambdajii=c^2 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





%STEP 7
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%THE FOLLOWING CALCULATION SHOWS lambdaijk=c^2 WHENEVER 1,i,j,k ARE 
%DISTINCT
%col labels: (12,[11]), (12,[21]), (12,[31]), (12,[12]), (24,[11])
%row labels: (1,[1]), (1,[2]), (1,[3]), (3,[1]), (3,[2])


t112 = trifocal(c1,c1,c2)
t214 = trifocal(c2,c1,c4)
t132 = trifocal(c1,c3,c2)
t234 = trifocal(c2,c3,c4)


m = [t112(1,1,1) t112(2,1,1) t112(3,1,1) t112(1,1,2) t214(1,1,1)
    t112(1,2,1) t112(2,2,1) t112(3,2,1) t112(1,2,2) t214(1,2,1)
    t112(1,3,1) t112(2,3,1) t112(3,3,1) t112(1,3,2) t214(1,3,1)
    t132(1,1,1) t132(2,1,1) t132(3,1,1) t132(1,1,2) t234(1,1,1)
    t132(1,2,1) t132(2,2,1) t132(3,2,1) t132(1,2,2) t234(1,2,1)]
    
a = randn
b = randn

n = [t112(1,1,1) t112(2,1,1) t112(3,1,1) t112(1,1,2) a*t214(1,1,1)
    t112(1,2,1) t112(2,2,1) t112(3,2,1) t112(1,2,2) a*t214(1,2,1)
    t112(1,3,1) t112(2,3,1) t112(3,3,1) t112(1,3,2) a*t214(1,3,1)
    a*t132(1,1,1) a*t132(2,1,1) a*t132(3,1,1) a*t132(1,1,2) b*t234(1,1,1)
    a*t132(1,2,1) a*t132(2,2,1) a*t132(3,2,1) a*t132(1,2,2) b*t234(1,2,1)]

svd(m)
%A sanity check: rank deficient as expected

svd(n)
%Full rank as wanted.  Follows det of m with lambda is a nonzero scalar 
%multiple of c*(lambda234-c^2). So assumptions imply 
%lambdaijk=c^2 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%











